<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment Status History - PT Pelindo Terminal Petikemas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Navbar Styles */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .navbar-scrolled {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .nav-container {
            max-width: 1500px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: #4b5563;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover {
            color: #1e40af;
            background-color: #f3f4f6;
        }

        .nav-link.active {
            color: #1e40af;
            background-color: #dbeafe;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 1rem;
            right: 1rem;
            height: 2px;
            background-color: #1e40af;
            border-radius: 2px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .user-info:hover {
            background-color: #f3f4f6;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.875rem;
        }

        .user-role {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .mobile-menu-button {
            display: none;
            background: none;
            border: none;
            color: #4b5563;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }

        .mobile-menu-button:hover {
            background-color: #f3f4f6;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            body {
                padding-top: 80px;
            }

            .nav-content {
                height: 60px;
            }

            .mobile-menu-button {
                display: block;
            }

            .nav-links {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                gap: 0;
                transform: translateY(-10px);
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }

            .nav-links.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }

            .nav-link {
                width: 100%;
                justify-content: flex-start;
                padding: 1rem;
                border-radius: 6px;
                margin-bottom: 0.25rem;
            }

            .user-menu {
                display: none;
            }

            .logo-text {
                font-size: 1.125rem;
            }

            .logo-icon {
                width: 35px;
                height: 35px;
                font-size: 1.125rem;
            }
        }

        @media (max-width: 480px) {
            .nav-container {
                padding: 0 0.75rem;
            }

            .logo-text span {
                display: none;
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            min-height: 100vh;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .status-ready { background-color: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
        .status-catatan { background-color: #fef3c7; color: #92400e; border-left: 4px solid #f59e0b; }
        .status-breakdown { background-color: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
        .status-maintenance { background-color: #e0e7ff; color: #3730a3; border-left: 4px solid #6366f1; }

        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background-color: rgb(21, 135, 241);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        thead th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        tbody td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }

        tbody tr:hover {
            background-color: #f9fafb;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            border-color: rgb(21, 135, 241);
            transform: scale(1.05);
        }

        .calendar-day.ready {
            background-color: #d1fae5;
            border-color: #10b981;
        }

        .calendar-day.catatan {
            background-color: #fef3c7;
            border-color: #f59e0b;
        }

        .calendar-day.breakdown {
            background-color: #fee2e2;
            border-color: #ef4444;
        }

        .calendar-day.maintenance {
            background-color: #e0e7ff;
            border-color: #6366f1;
        }

        .filter-section {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .select-box {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
            min-width: 150px;
        }

        .select-box:focus {
            outline: none;
            border-color: rgb(21, 135, 241);
        }

        .input-box {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            background: white;
            transition: border-color 0.3s ease;
            min-width: 150px;
        }

        .input-box:focus {
            outline: none;
            border-color: rgb(21, 135, 241);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
        }

        .trend-up {
            background-color: #d1fae5;
            color: #065f46;
        }

        .trend-down {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }

        .status-legend {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .card {
                padding: 1rem;
            }

            thead th,
            tbody td {
                padding: 0.75rem 0.5rem;
                font-size: 0.75rem;
            }

            table {
                min-width: 700px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 0.25rem;
            }

            .calendar-day {
                font-size: 0.65rem;
            }

            .select-box, .input-box {
                min-width: 120px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0.5rem !important;
            }

            table {
                min-width: 600px;
            }

            h1 {
                font-size: 1.25rem !important;
            }

            h2 {
                font-size: 1rem !important;
            }
        }

        @media print {
            body {
                background: white;
            }
            
            button {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                page-break-inside: avoid;
            }

            .modal {
                display: none !important;
            }
        }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Back Button & Header -->
            <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-content">
                <!-- Logo -->
                <a href="#" class="logo">
                    <img src="img/Pelindo Terminal Petikemas.png" alt="Pelindo Logo" class="h-10 w-auto">
                </a>

                <!-- Desktop Navigation -->
                <div class="nav-links" id="navLinks">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                     <a href="daily_report.html" class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Daily Report</span>
                    </a>
                    <a href="monthly_report.html" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Monthly Report</span>
                    </a>
                    <a href="equipment_status_history.html" class="nav-link active">
                        <i class="fas fa-history"></i>
                        <span>Equipment History</span>
                    </a>
                    <a href="breakdown_list.html" class="nav-link">
                        <i class="fas fa-triangle-exclamation"></i>
                        <span>Breakdown List</span>
                    </a>
                </div>

                <!-- User Menu -->
                <div class="user-menu">
                    <div class="user-info">
                        <div class="user-avatar">
                            AS
                        </div>
                        <div class="user-details">
                            <div class="user-name">Admin Supervisor</div>
                            <div class="user-role">Terminal Manager</div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Menu Button -->
                <button class="mobile-menu-button" id="mobileMenuButton">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6 mt-20">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-xl md:text-2xl lg:text-3xl font-bold text-gray-800">EQUIPMENT STATUS HISTORY</h1>
                    <h2 class="text-base md:text-lg lg:text-xl font-semibold text-blue-600 mt-1" id="equipmentName">QC-001 - Quay Crane</h2>
                    <p class="text-xs md:text-sm text-gray-500 mt-1">Histori kondisi harian peralatan terminal</p>
                </div>
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick="exportHistory()" class="flex-1 md:flex-none bg-green-500 text-white px-3 md:px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition text-xs md:text-sm flex items-center gap-2">
                        <i class="fas fa-file-export"></i>
                        Export
                    </button>
                    <button onclick="printReport()" class="flex-1 md:flex-none bg-blue-500 text-white px-3 md:px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition text-xs md:text-sm flex items-center gap-2">
                        <i class="fas fa-print"></i>
                        Print
                    </button>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="card mb-4 md:mb-6">
            <div class="filter-section">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Pilih Cabang</label>
                    <select id="branchSelect" class="select-box" onchange="updateEquipmentHistory()">
                        <option value="all">Semua Cabang</option>
                        <option value="jakarta">Terminal Jakarta</option>
                        <option value="surabaya">Terminal Surabaya</option>
                        <option value="makassar1">Terminal Makassar 1</option>
                        <option value="makassar2">Terminal Makassar 2</option>
                        <option value="manado">Terminal Manado</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Pilih Alat</label>
                    <select id="equipmentSelect" class="select-box" onchange="updateEquipmentHistory()">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Periode Mulai</label>
                    <input type="date" id="startDate" class="input-box" value="2025-09-01">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Periode Akhir</label>
                    <input type="date" id="endDate" class="input-box" value="2025-09-30">
                </div>
                
                <div class="flex items-end">
                    <button onclick="applyFilters()" class="bg-blue-500 text-white px-4 py-2.5 rounded-lg font-semibold hover:bg-blue-600 transition text-sm flex items-center gap-2">
                        <i class="fas fa-filter"></i>
                        Terapkan Filter
                    </button>
                </div>
            </div>
        </div>

        <!-- Equipment Summary -->
        <div class="stats-grid mb-4 md:mb-6">
            <div class="card bg-gradient-to-br from-blue-500 to-blue-600 text-white">
                <h3 class="text-sm md:text-base font-semibold mb-2">Total Hari</h3>
                <p class="text-2xl md:text-3xl font-bold" id="totalDays">0</p>
                <p class="text-xs mt-1" id="dateRange">-</p>
            </div>
            <div class="card bg-gradient-to-br from-green-500 to-green-600 text-white">
                <h3 class="text-sm md:text-base font-semibold mb-2">Hari Ready</h3>
                <p class="text-2xl md:text-3xl font-bold" id="readyDays">0</p>
                <p class="text-xs mt-1" id="readyPercent">0%</p>
            </div>
            <div class="card bg-gradient-to-br from-amber-500 to-amber-600 text-white">
                <h3 class="text-sm md:text-base font-semibold mb-2">Hari Catatan</h3>
                <p class="text-2xl md:text-3xl font-bold" id="catatanDays">0</p>
                <p class="text-xs mt-1" id="catatanPercent">0%</p>
            </div>
            <div class="card bg-gradient-to-br from-red-500 to-red-600 text-white">
                <h3 class="text-sm md:text-base font-semibold mb-2">Hari Breakdown</h3>
                <p class="text-2xl md:text-3xl font-bold" id="breakdownDays">0</p>
                <p class="text-xs mt-1" id="breakdownPercent">0%</p>
            </div>
        </div>

        <!-- Equipment Details -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-4 md:mb-6">
            <!-- Equipment Info Card -->
            <div class="card lg:col-span-1">
                <h3 class="text-base md:text-lg font-bold text-gray-800 mb-4">Informasi Alat</h3>
                <div class="space-y-3">
                    <div>
                        <p class="text-sm text-gray-600">Nomor Alat</p>
                        <p class="font-semibold text-gray-800" id="infoEquipmentNo">-</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Kategori</p>
                        <p class="font-semibold text-gray-800" id="infoCategory">-</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Tahun Operasi</p>
                        <p class="font-semibold text-gray-800" id="infoYear">-</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Lokasi</p>
                        <p class="font-semibold text-gray-800" id="infoLocation">-</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Availability Rate</p>
                        <p class="font-semibold text-green-600" id="infoAvailability">-</p>
                    </div>
                </div>
            </div>

            <!-- Status Trend Chart -->
            <div class="card lg:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-base md:text-lg font-bold text-gray-800">Trend Status Harian</h3>
                    <button onclick="toggleChartView()" class="text-blue-600 text-sm font-semibold hover:text-blue-800 transition flex items-center gap-1">
                        <i class="fas fa-chart-bar"></i>
                        Tampilkan Grafik Batang
                    </button>
                </div>
                <div class="chart-container">
                    <canvas id="statusTrendChart"></canvas>
                </div>
                <div class="status-legend">
                    <div class="legend-item">
                        <div class="legend-color bg-green-500"></div>
                        <span>Ready</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color bg-amber-500"></div>
                        <span>Catatan</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color bg-red-500"></div>
                        <span>Breakdown</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color bg-indigo-500"></div>
                        <span>Maintenance</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status History Table -->
        <div class="card mb-4 md:mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-2">
                <h3 class="text-base md:text-lg lg:text-xl font-bold text-gray-800">Histori Status Harian</h3>
                <div class="flex gap-2">
                    <button onclick="showCalendarView()" class="bg-white text-blue-600 border border-blue-600 px-3 py-2 rounded-lg font-semibold hover:bg-blue-50 transition text-xs md:text-sm flex items-center gap-2">
                        <i class="fas fa-calendar-alt"></i>
                        Tampilan Kalender
                    </button>
                    <button onclick="showStatistics()" class="bg-white text-green-600 border border-green-600 px-3 py-2 rounded-lg font-semibold hover:bg-green-50 transition text-xs md:text-sm flex items-center gap-2">
                        <i class="fas fa-chart-pie"></i>
                        Statistik Detail
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table id="historyTable">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Hari</th>
                            <th>Status</th>
                            <th>Durasi (Jam)</th>
                            <th>Keterangan</th>
                            <th>Teknisi</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Breakdown Analysis -->
        <div class="card">
            <h3 class="text-base md:text-lg lg:text-xl font-bold text-gray-800 mb-4">Analisis Breakdown</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Penyebab Breakdown</h4>
                    <div class="space-y-2" id="breakdownCauses">
                        <!-- Breakdown causes will be inserted here -->
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Rekomendasi Perbaikan</h4>
                    <div class="space-y-2" id="repairRecommendations">
                        <!-- Repair recommendations will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Calendar View -->
    <div id="calendarModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg md:text-xl font-bold text-gray-800" id="calendarModalTitle">Tampilan Kalender - QC-001</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">×</button>
            </div>
            <div id="calendarContent">
                <!-- Calendar will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Modal for Statistics -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg md:text-xl font-bold text-gray-800" id="statsModalTitle">Statistik Detail - QC-001</h3>
                <button onclick="closeStatsModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">×</button>
            </div>
            <div id="statsContent">
                <!-- Statistics will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Navbar functionality
        function initNavbar() {
            const navbar = document.getElementById('navbar');
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const navLinks = document.getElementById('navLinks');

            // Scroll effect
            window.addEventListener('scroll', () => {
                if (window.scrollY > 10) {
                    navbar.classList.add('navbar-scrolled');
                } else {
                    navbar.classList.remove('navbar-scrolled');
                }
            });

            // Mobile menu toggle
            mobileMenuButton.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                
                // Change icon
                const icon = mobileMenuButton.querySelector('i');
                if (navLinks.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });

            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!navbar.contains(e.target) && navLinks.classList.contains('active')) {
                    navLinks.classList.remove('active');
                    const icon = mobileMenuButton.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });

            // Close mobile menu when window is resized to desktop
            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    navLinks.classList.remove('active');
                    const icon = mobileMenuButton.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
        }

        // Initialize navbar when page loads
        document.addEventListener('DOMContentLoaded', initNavbar);

        // Equipment data dengan informasi cabang
        const equipmentData = {
            'QC-001': {
                name: 'Quay Crane 001',
                category: 'Alat Dermaga',
                year: 2018,
                location: 'Dermaga 1',
                availability: '92.5%',
                branch: 'jakarta'
            },
            'QC-002': {
                name: 'Quay Crane 002',
                category: 'Alat Dermaga',
                year: 2019,
                location: 'Dermaga 1',
                availability: '88.3%',
                branch: 'jakarta'
            },
            'RTG-001': {
                name: 'RTG 001',
                category: 'Alat CY',
                year: 2020,
                location: 'Yard A',
                availability: '95.1%',
                branch: 'surabaya'
            },
            'RTG-002': {
                name: 'RTG 002',
                category: 'Alat CY',
                year: 2020,
                location: 'Yard A',
                availability: '93.7%',
                branch: 'surabaya'
            },
            'TT-001': {
                name: 'Terminal Tractor 001',
                category: 'Alat Angkut',
                year: 2021,
                location: 'Yard B',
                availability: '89.2%',
                branch: 'makassar1'
            },
            'RH-001': {
                name: 'Reach Stacker 001',
                category: 'Alat Mobile',
                year: 2019,
                location: 'Yard C',
                availability: '91.8%',
                branch: 'makassar2'
            },
            'QC-003': {
                name: 'Quay Crane 003',
                category: 'Alat Dermaga',
                year: 2020,
                location: 'Dermaga 2',
                availability: '90.2%',
                branch: 'manado'
            },
            'RTG-003': {
                name: 'RTG 003',
                category: 'Alat CY',
                year: 2021,
                location: 'Yard B',
                availability: '94.1%',
                branch: 'manado'
            }
        };

        const branchNames = {
            'jakarta': 'Terminal Jakarta',
            'surabaya': 'Terminal Surabaya',
            'makassar1': 'Terminal Makassar 1',
            'makassar2': 'Terminal Makassar 2',
            'manado': 'Terminal Manado'
        };

        let statusHistoryData = {};
        let currentChart = null;
        let isLineChart = true;
        let currentBranch = 'all';

        // Generate status history for equipment
        function generateStatusHistory(equipmentId, startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const history = [];
            
            // Reset current date to start
            const currentDate = new Date(start);
            
            while (currentDate <= end) {
                const statusTypes = ['ready', 'catatan', 'breakdown', 'maintenance'];
                const weights = [0.70, 0.15, 0.10, 0.05]; // Probability weights
                
                // Weighted random status
                const rand = Math.random();
                let status = 'ready';
                let cumulativeWeight = 0;
                
                for (let i = 0; i < statusTypes.length; i++) {
                    cumulativeWeight += weights[i];
                    if (rand < cumulativeWeight) {
                        status = statusTypes[i];
                        break;
                    }
                }
                
                // Generate details based on status
                let duration = 24;
                let note = '';
                let technician = '';
                
                switch(status) {
                    case 'ready':
                        note = 'Operasional normal';
                        technician = '-';
                        break;
                    case 'catatan':
                        duration = 22 + Math.floor(Math.random() * 2); // 22-23 hours
                        const catatanNotes = [
                            'Performa menurun, perlu monitoring',
                            'Minor issue, tidak mengganggu operasi',
                            'Perlu pengecekan rutin'
                        ];
                        note = catatanNotes[Math.floor(Math.random() * catatanNotes.length)];
                        technician = 'Tech A';
                        break;
                    case 'breakdown':
                        duration = 8 + Math.floor(Math.random() * 16); // 8-23 hours
                        const breakdownNotes = [
                            'Kerusakan sistem hidrolik',
                            'Masalah electrical',
                            'Komponen mekanik perlu penggantian'
                        ];
                        note = breakdownNotes[Math.floor(Math.random() * breakdownNotes.length)];
                        technician = 'Tech B';
                        break;
                    case 'maintenance':
                        duration = 12 + Math.floor(Math.random() * 12); // 12-23 hours
                        note = 'Maintenance rutin';
                        technician = 'Tech C';
                        break;
                }
                
                history.push({
                    date: new Date(currentDate),
                    day: currentDate.toLocaleDateString('id-ID', { weekday: 'long' }),
                    status: status,
                    duration: duration,
                    note: note,
                    technician: technician
                });
                
                // Move to next day
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            return history;
        }

        // Initialize equipment select berdasarkan cabang
        function initializeEquipmentSelect() {
            const branchSelect = document.getElementById('branchSelect');
            const equipmentSelect = document.getElementById('equipmentSelect');
            
            // Update equipment options berdasarkan cabang yang dipilih
            updateEquipmentOptions();
            
            // Event listener untuk perubahan cabang
            branchSelect.addEventListener('change', function() {
                currentBranch = this.value;
                updateEquipmentOptions();
                updateEquipmentHistory();
            });
        }

        // Update equipment options berdasarkan cabang
        function updateEquipmentOptions() {
            const equipmentSelect = document.getElementById('equipmentSelect');
            let html = '';
            
            for (const [id, data] of Object.entries(equipmentData)) {
                if (currentBranch === 'all' || data.branch === currentBranch) {
                    html += `<option value="${id}">${id} - ${data.name}</option>`;
                }
            }
            
            equipmentSelect.innerHTML = html;
            
            // Update header jika equipment tersedia
            if (html) {
                const firstEquipment = equipmentSelect.value;
                document.getElementById('equipmentName').textContent = 
                    `${firstEquipment} - ${equipmentData[firstEquipment].name}`;
            }
        }

        // Update equipment history
        function updateEquipmentHistory() {
            const equipmentSelect = document.getElementById('equipmentSelect');
            const equipmentId = equipmentSelect.value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!equipmentId) return;
            
            // Update equipment name in header
            document.getElementById('equipmentName').textContent = `${equipmentId} - ${equipmentData[equipmentId].name}`;
            
            // Generate history data
            statusHistoryData = generateStatusHistory(equipmentId, startDate, endDate);
            
            // Update UI
            updateSummaryStats();
            updateEquipmentInfo(equipmentId);
            renderHistoryTable();
            renderStatusChart();
            updateBreakdownAnalysis();
        }

        // Apply filters
        function applyFilters() {
            updateEquipmentHistory();
        }

        // Update summary statistics
        function updateSummaryStats() {
            const total = statusHistoryData.length;
            const ready = statusHistoryData.filter(d => d.status === 'ready').length;
            const catatan = statusHistoryData.filter(d => d.status === 'catatan').length;
            const breakdown = statusHistoryData.filter(d => d.status === 'breakdown').length;
            const maintenance = statusHistoryData.filter(d => d.status === 'maintenance').length;
            
            document.getElementById('totalDays').textContent = total;
            document.getElementById('readyDays').textContent = ready;
            document.getElementById('catatanDays').textContent = catatan;
            document.getElementById('breakdownDays').textContent = breakdown;
            
            document.getElementById('readyPercent').textContent = ((ready / total) * 100).toFixed(1) + '%';
            document.getElementById('catatanPercent').textContent = ((catatan / total) * 100).toFixed(1) + '%';
            document.getElementById('breakdownPercent').textContent = ((breakdown / total) * 100).toFixed(1) + '%';
            
            // Update date range
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            document.getElementById('dateRange').textContent = 
                `${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}`;
        }

        // Update equipment info
        function updateEquipmentInfo(equipmentId) {
            const info = equipmentData[equipmentId];
            document.getElementById('infoEquipmentNo').textContent = equipmentId;
            document.getElementById('infoCategory').textContent = info.category;
            document.getElementById('infoYear').textContent = info.year;
            document.getElementById('infoLocation').textContent = `${info.location} - ${branchNames[info.branch]}`;
            document.getElementById('infoAvailability').textContent = info.availability;
        }

        // Render history table
        function renderHistoryTable() {
            const tbody = document.getElementById('historyBody');
            let html = '';
            
            statusHistoryData.forEach(record => {
                const dateStr = record.date.toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
                
                const statusClass = `status-${record.status}`;
                const statusText = record.status.charAt(0).toUpperCase() + record.status.slice(1);
                
                html += `
                    <tr>
                        <td class="font-semibold">${dateStr}</td>
                        <td>${record.day}</td>
                        <td>
                            <span class="inline-block px-3 py-1 rounded-lg text-xs font-semibold ${statusClass}">
                                ${statusText}
                            </span>
                        </td>
                        <td>${record.duration} jam</td>
                        <td>${record.note}</td>
                        <td>${record.technician}</td>
                        <td>
                            <button onclick="viewDetail('${dateStr}')" class="text-blue-600 hover:text-blue-800 text-sm font-semibold">
                                <i class="fas fa-eye"></i> Detail
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // Render status chart
        function renderStatusChart() {
            const ctx = document.getElementById('statusTrendChart').getContext('2d');
            
            // Destroy previous chart if exists
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Prepare data
            const dates = statusHistoryData.map(d => 
                d.date.toLocaleDateString('id-ID', { day: '2-digit', month: '2-digit' })
            );
            
            const statusValues = statusHistoryData.map(d => {
                switch(d.status) {
                    case 'ready': return 4;
                    case 'maintenance': return 3;
                    case 'catatan': return 2;
                    case 'breakdown': return 1;
                    default: return 0;
                }
            });
            
            // Create chart
            currentChart = new Chart(ctx, {
                type: isLineChart ? 'line' : 'bar',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Status Harian',
                        data: statusValues,
                        borderColor: 'rgb(21, 135, 241)',
                        backgroundColor: isLineChart ? 'transparent' : 'rgba(21, 135, 241, 0.5)',
                        borderWidth: 2,
                        pointBackgroundColor: statusHistoryData.map(d => {
                            switch(d.status) {
                                case 'ready': return '#10b981';
                                case 'catatan': return '#f59e0b';
                                case 'breakdown': return '#ef4444';
                                case 'maintenance': return '#6366f1';
                                default: return '#6b7280';
                            }
                        }),
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            min: 0,
                            max: 5,
                            ticks: {
                                callback: function(value) {
                                    switch(value) {
                                        case 1: return 'Breakdown';
                                        case 2: return 'Catatan';
                                        case 3: return 'Maintenance';
                                        case 4: return 'Ready';
                                        default: return '';
                                    }
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const record = statusHistoryData[index];
                                    return `Status: ${record.status.charAt(0).toUpperCase() + record.status.slice(1)} - ${record.note}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Toggle chart view
        function toggleChartView() {
            isLineChart = !isLineChart;
            const button = document.querySelector('button[onclick="toggleChartView()"]');
            button.innerHTML = isLineChart ? 
                '<i class="fas fa-chart-bar"></i> Tampilkan Grafik Batang' : 
                '<i class="fas fa-chart-line"></i> Tampilkan Grafik Garis';
            renderStatusChart();
        }

        // Show calendar view
        function showCalendarView() {
            const equipmentId = document.getElementById('equipmentSelect').value;
            const modal = document.getElementById('calendarModal');
            const modalTitle = document.getElementById('calendarModalTitle');
            const calendarContent = document.getElementById('calendarContent');
            
            modalTitle.textContent = `Tampilan Kalender - ${equipmentId}`;
            
            // Group by month
            const groupedByMonth = {};
            statusHistoryData.forEach(record => {
                const monthYear = record.date.toLocaleDateString('id-ID', { year: 'numeric', month: 'long' });
                if (!groupedByMonth[monthYear]) {
                    groupedByMonth[monthYear] = [];
                }
                groupedByMonth[monthYear].push(record);
            });
            
            let html = '';
            
            for (const [monthYear, records] of Object.entries(groupedByMonth)) {
                html += `<h4 class="font-bold text-gray-800 mt-4 mb-2">${monthYear}</h4>`;
                html += `<div class="calendar-grid">`;
                
                records.forEach(record => {
                    const day = record.date.getDate();
                    html += `
                        <div class="calendar-day ${record.status}" title="${record.date.toLocaleDateString('id-ID')} - ${record.status}">
                            <div class="text-xs text-gray-600">Tgl</div>
                            <div class="font-bold">${day}</div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            calendarContent.innerHTML = html;
            modal.classList.add('active');
        }

        // Show statistics
        function showStatistics() {
            const equipmentId = document.getElementById('equipmentSelect').value;
            const modal = document.getElementById('statsModal');
            const modalTitle = document.getElementById('statsModalTitle');
            const statsContent = document.getElementById('statsContent');
            
            modalTitle.textContent = `Statistik Detail - ${equipmentId}`;
            
            // Calculate statistics
            const total = statusHistoryData.length;
            const ready = statusHistoryData.filter(d => d.status === 'ready').length;
            const catatan = statusHistoryData.filter(d => d.status === 'catatan').length;
            const breakdown = statusHistoryData.filter(d => d.status === 'breakdown').length;
            const maintenance = statusHistoryData.filter(d => d.status === 'maintenance').length;
            
            const readyPercent = ((ready / total) * 100).toFixed(1);
            const catatanPercent = ((catatan / total) * 100).toFixed(1);
            const breakdownPercent = ((breakdown / total) * 100).toFixed(1);
            const maintenancePercent = ((maintenance / total) * 100).toFixed(1);
            
            // Calculate average operational hours
            const avgOperationalHours = (statusHistoryData.reduce((sum, d) => sum + d.duration, 0) / total).toFixed(1);
            
            // Find longest breakdown
            const breakdowns = statusHistoryData.filter(d => d.status === 'breakdown');
            const longestBreakdown = breakdowns.length > 0 ? 
                Math.max(...breakdowns.map(d => 24 - d.duration)) : 0;
            
            let html = `
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-700 mb-2">Distribusi Status</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span>Ready:</span>
                                <span class="font-semibold">${ready} hari (${readyPercent}%)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Catatan:</span>
                                <span class="font-semibold">${catatan} hari (${catatanPercent}%)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Breakdown:</span>
                                <span class="font-semibold">${breakdown} hari (${breakdownPercent}%)</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Maintenance:</span>
                                <span class="font-semibold">${maintenance} hari (${maintenancePercent}%)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-700 mb-2">Metrik Operasional</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span>Rata-rata Jam Operasi:</span>
                                <span class="font-semibold">${avgOperationalHours} jam/hari</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Breakdown Terpanjang:</span>
                                <span class="font-semibold">${longestBreakdown} jam</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Availability Rate:</span>
                                <span class="font-semibold text-green-600">${equipmentData[equipmentId].availability}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-gray-700 mb-2">Rekomendasi</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li>Lakukan preventive maintenance secara berkala</li>
                        <li>Monitor performa alat setelah breakdown</li>
                        <li>Optimasi jadwal maintenance berdasarkan data historis</li>
                    </ul>
                </div>
            `;
            
            statsContent.innerHTML = html;
            modal.classList.add('active');
        }

        // Update breakdown analysis
        function updateBreakdownAnalysis() {
            const breakdowns = statusHistoryData.filter(d => d.status === 'breakdown');
            
            // Breakdown causes
            const causesHtml = breakdowns.length > 0 ? 
                breakdowns.map(b => `<div class="flex justify-between py-1 border-b border-gray-200">
                    <span>${b.date.toLocaleDateString('id-ID')}</span>
                    <span class="font-semibold">${b.note}</span>
                </div>`).join('') :
                '<p class="text-gray-500 text-sm">Tidak ada breakdown pada periode ini</p>';
            
            document.getElementById('breakdownCauses').innerHTML = causesHtml;
            
            // Repair recommendations
            const recommendations = [
                'Periksa sistem hidrolik secara berkala',
                'Lakukan kalibrasi sensor secara rutin',
                'Ganti komponen wear parts sesuai jadwal',
                'Update software control system',
                'Training operator untuk handling yang tepat'
            ];
            
            const recHtml = recommendations.map(rec => 
                `<div class="flex items-start gap-2 py-1">
                    <i class="fas fa-check text-green-500 mt-1"></i>
                    <span class="text-sm">${rec}</span>
                </div>`
            ).join('');
            
            document.getElementById('repairRecommendations').innerHTML = recHtml;
        }

        // View detail
        function viewDetail(dateStr) {
            alert(`Detail untuk tanggal ${dateStr} akan ditampilkan di sini.`);
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('calendarModal');
            modal.classList.remove('active');
        }

        // Close stats modal
        function closeStatsModal() {
            const modal = document.getElementById('statsModal');
            modal.classList.remove('active');
        }

        // Export history
        function exportHistory() {
            alert('Fitur export Excel akan segera tersedia!');
        }

        // Print report
        function printReport() {
            window.print();
        }

        // Close modals on outside click
        document.getElementById('calendarModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        document.getElementById('statsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeStatsModal();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeEquipmentSelect();
            updateEquipmentHistory();
        });
    </script>
</body>
</html>