<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Terminal Report - PT Pelindo Terminal Petikemas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .navbar-scrolled {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .nav-container {
            max-width: 1500px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: #4b5563;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-link:hover {
            color: #1e40af;
            background-color: #f3f4f6;
        }

        .nav-link.active {
            color: #1e40af;
            background-color: #dbeafe;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 1rem;
            right: 1rem;
            height: 2px;
            background-color: #1e40af;
            border-radius: 2px;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .user-info:hover {
            background-color: #f3f4f6;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.875rem;
        }

        .user-role {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .mobile-menu-button {
            display: none;
            background: none;
            border: none;
            color: #4b5563;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }

        .mobile-menu-button:hover {
            background-color: #f3f4f6;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            body {
                padding-top: 80px;
            }

            .nav-content {
                height: 60px;
            }

            .mobile-menu-button {
                display: block;
            }

            .nav-links {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                gap: 0;
                transform: translateY(-10px);
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }

            .nav-links.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }

            .nav-link {
                width: 100%;
                justify-content: flex-start;
                padding: 1rem;
                border-radius: 6px;
                margin-bottom: 0.25rem;
            }

            .user-menu {
                display: none;
            }

            .logo-text {
                font-size: 1.125rem;
            }

            .logo-icon {
                width: 35px;
                height: 35px;
                font-size: 1.125rem;
            }
        }

        @media (max-width: 480px) {
            .nav-container {
                padding: 0 0.75rem;
            }

            .logo-text span {
                display: none;
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            min-height: 100vh;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background-color: rgb(21, 135, 241);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        thead th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        tbody td {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }

        tbody tr:hover {
            background-color: #f9fafb;
        }

        .equipment-row {
            font-weight: 600;
            background-color: #f3f4f6;
        }

        .equipment-row td {
            border-bottom: 2px solid #d1d5db;
        }

        .progress-bar {
            height: 24px;
            border-radius: 12px;
            background-color: #e5e7eb;
            overflow: hidden;
            display: flex;
            position: relative;
        }

        .progress-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            transition: width 0.3s ease;
        }

        .ready-bar { background-color: #10b981; }
        .catatan-bar { background-color: #f59e0b; }
        .breakdown-bar { background-color: #ef4444; }

        .percentage-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0 0.25rem;
        }

        .ready-badge { background-color: #d1fae5; color: #065f46; }
        .catatan-badge { background-color: #fef3c7; color: #92400e; }
        .breakdown-badge { background-color: #fee2e2; color: #991b1b; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            border-color: rgb(21, 135, 241);
            transform: scale(1.05);
        }

        .calendar-day.ready {
            background-color: #d1fae5;
            border-color: #10b981;
        }

        .calendar-day.catatan {
            background-color: #fef3c7;
            border-color: #f59e0b;
        }

        .calendar-day.breakdown {
            background-color: #fee2e2;
            border-color: #ef4444;
        }

        .filter-section {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .select-box {
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
            min-width: 150px;
        }

        .select-box:focus {
            outline: none;
            border-color: rgb(21, 135, 241);
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
        }

        .trend-up {
            background-color: #d1fae5;
            color: #065f46;
        }

        .trend-down {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .card {
                padding: 1rem;
            }

            thead th,
            tbody td {
                padding: 0.75rem 0.5rem;
                font-size: 0.75rem;
            }

            table {
                min-width: 700px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 0.25rem;
            }

            .calendar-day {
                font-size: 0.65rem;
            }

            .select-box {
                min-width: 120px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0.5rem !important;
            }

            table {
                min-width: 600px;
            }

            .progress-bar {
                height: 20px;
            }

            .progress-segment {
                font-size: 0.6rem;
            }

            h1 {
                font-size: 1.25rem !important;
            }

            h2 {
                font-size: 1rem !important;
            }
        }

        @media print {
            body {
                background: white;
            }
            
            button {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                page-break-inside: avoid;
            }

            .modal {
                display: none !important;
            }
        }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
            <!-- Fixed Navbar -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-content">
                <!-- Logo -->
                <a href="#" class="logo">
                    <img src="img/Pelindo Terminal Petikemas.png" alt="Pelindo Logo" class="h-10 w-auto">
                </a>

                <!-- Desktop Navigation -->
                <div class="nav-links" id="navLinks">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                     <a href="daily_report.html" class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Daily Report</span>
                    </a>
                    <a href="monthly_report.html" class="nav-link active">
                        <i class="fas fa-chart-line"></i>
                        <span>Monthly Report</span>
                    </a>
                    <a href="equipment_status_history.html" class="nav-link">
                        <i class="fas fa-history"></i>
                        <span>Equipment History</span>
                    </a>
                    <a href="breakdown_list.html" class="nav-link">
                        <i class="fas fa-triangle-exclamation"></i>
                        <span>Breakdown List</span>
                    </a>
                </div>

                <!-- User Menu -->
                <div class="user-menu">
                    <div class="user-info">
                        <div class="user-avatar">
                            AS
                        </div>
                        <div class="user-details">
                            <div class="user-name">Admin Supervisor</div>
                            <div class="user-role">Terminal Manager</div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Menu Button -->
                <button class="mobile-menu-button" id="mobileMenuButton">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6 mt-20">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-xl md:text-2xl lg:text-3xl font-bold text-gray-800">MONTHLY TERMINAL REPORT</h1>
                    <h2 class="text-base md:text-lg lg:text-xl font-semibold text-blue-600 mt-1" id="terminalName">Terminal Jakarta</h2>
                    <p class="text-xs md:text-sm text-gray-500 mt-1">Periode: <span id="reportPeriod"></span></p>
                </div>
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick="exportReport()" class="flex-1 md:flex-none bg-green-500 text-white px-3 md:px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition text-xs md:text-sm"> <i class="fas fa-file-export"></i>
                        Export
                    </button>
                    <button onclick="printReport()" class="flex-1 md:flex-none bg-blue-500 text-white px-3 md:px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition text-xs md:text-sm"> <i class="fas fa-print"></i>
                        Print
                    </button>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="card mb-4 md:mb-6">
            <div class="filter-section">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Pilih Bulan</label>
                    <select id="monthSelect" class="select-box" onchange="updateReport()">
                        <option value="0">Januari 2025</option>
                        <option value="1">Februari 2025</option>
                        <option value="2">Maret 2025</option>
                        <option value="3">April 2025</option>
                        <option value="4">Mei 2025</option>
                        <option value="5">Juni 2025</option>
                        <option value="6">Juli 2025</option>
                        <option value="7">Agustus 2025</option>
                        <option value="8" selected>September 2025</option>
                        <option value="9">Oktober 2025</option>
                        <option value="10">November 2025</option>
                        <option value="11">Desember 2025</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Filter Kategori</label>
                    <select id="categoryFilter" class="select-box" onchange="filterByCategory()">
                        <option value="all">Semua Kategori</option>
                        <option value="dermaga">Alat Dermaga</option>
                        <option value="cy">Alat CY</option>
                        <option value="mobile">Alat Mobile</option>
                        <option value="angkut">Alat Angkut</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Pilih Cabang</label>
                    <select id="categoryFilter" class="select-box" onchange="filterByCategory()">
                        <option>Jakarta</option>
                        <option>Surabaya</option>
                        <option>Makassar 1</option>
                        <option>Makassar 2</option>
                        <option>Manado</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Summary Statistics -->
        <div class="stats-grid">
            <div class="card bg-gradient-to-br from-blue-500 to-blue-600 text-white">
                <h3 class="text-sm md:text-base font-semibold mb-2">Total Hari Operasi</h3>
                <p class="text-2xl md:text-3xl font-bold" id="totalDays">30</p>
            </div>
            <div class="card bg-gradient-to-br from-green-500 to-green-600 text-white">
                <h3 class="text-sm md:text-base font-semibold mb-2">Avg. Ready Rate</h3>
                <p class="text-2xl md:text-3xl font-bold" id="avgReady">0%</p>
            </div>
            <div class="card bg-gradient-to-br from-amber-500 to-amber-600 text-white">
                <h3 class="text-sm md:text-base font-semibold mb-2">Avg. Catatan Rate</h3>
                <p class="text-2xl md:text-3xl font-bold" id="avgCatatan">0%</p>
            </div>
            <div class="card bg-gradient-to-br from-red-500 to-red-600 text-white">
                <h3 class="text-sm md:text-base font-semibold mb-2">Avg. Breakdown Rate</h3>
                <p class="text-2xl md:text-3xl font-bold" id="avgBreakdown">0%</p>
            </div>
        </div>

        <!-- Equipment Performance Table -->
        <div class="card mb-4 md:mb-6">
            <h3 class="text-base md:text-lg lg:text-xl font-bold text-gray-800 mb-4">Performa Kesiapan Alat per Bulan</h3>
            <p class="text-xs md:text-sm text-gray-600 mb-4">Klik pada baris alat untuk melihat detail kalender harian</p>
            
            <div class="table-container">
                <table id="performanceTable">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Kategori</th>
                            <th>Nomor Alat</th>
                            <th>Ready (%)</th>
                            <th>Catatan (%)</th>
                            <th>Breakdown (%)</th>
                            <th>Visualisasi Status</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody id="performanceBody">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Category Summary -->
        <div class="card">
            <h3 class="text-base md:text-lg lg:text-xl font-bold text-gray-800 mb-4">Ringkasan per Kategori</h3>
            <div id="categorySummary" class="space-y-4">
                <!-- Category summaries will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Modal for Calendar View -->
    <div id="calendarModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg md:text-xl font-bold text-gray-800" id="modalTitle">Detail Harian</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">×</button>
            </div>
            <div id="calendarContent">
                <!-- Calendar will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Sample data generator
        const equipmentList = [
            { category: 'dermaga', numbers: ['QC-001', 'QC-002', 'QC-003', 'CC-001', 'CC-002'] },
            { category: 'cy', numbers: ['RTG-001', 'RTG-002', 'RTG-003', 'RS-001', 'RS-002'] },
            { category: 'mobile', numbers: ['RH-001', 'RH-002', 'FL-001', 'FL-002'] },
            { category: 'angkut', numbers: ['TT-001', 'TT-002', 'TT-003', 'HT-001', 'HT-002'] }
        ];

        const categoryNames = {
            'dermaga': 'Alat Dermaga',
            'cy': 'Alat CY',
            'mobile': 'Alat Mobile',
            'angkut': 'Alat Angkut'
        };

        let monthlyData = {};
        let currentFilter = 'all';

        // Generate random status for a day
        function generateDayStatus() {
            const rand = Math.random();
            if (rand < 0.75) return 'ready';
            if (rand < 0.90) return 'catatan';
            return 'breakdown';
        }

        // Generate monthly data for all equipment
        function generateMonthlyData(daysInMonth) {
            const data = {};
            
            equipmentList.forEach(category => {
                category.numbers.forEach(equipNumber => {
                    const dailyStatus = [];
                    for (let day = 1; day <= daysInMonth; day++) {
                        dailyStatus.push({
                            day: day,
                            status: generateDayStatus()
                        });
                    }
                    data[equipNumber] = {
                        category: category.category,
                        dailyStatus: dailyStatus
                    };
                });
            });
            
            return data;
        }

        // Calculate statistics for an equipment
        function calculateEquipmentStats(dailyStatus) {
            const total = dailyStatus.length;
            const ready = dailyStatus.filter(d => d.status === 'ready').length;
            const catatan = dailyStatus.filter(d => d.status === 'catatan').length;
            const breakdown = dailyStatus.filter(d => d.status === 'breakdown').length;
            
            return {
                readyPercent: ((ready / total) * 100).toFixed(1),
                catatanPercent: ((catatan / total) * 100).toFixed(1),
                breakdownPercent: ((breakdown / total) * 100).toFixed(1),
                ready: ready,
                catatan: catatan,
                breakdown: breakdown
            };
        }

        // Calculate overall statistics
        function calculateOverallStats() {
            let totalReady = 0;
            let totalCatatan = 0;
            let totalBreakdown = 0;
            let count = 0;

            Object.values(monthlyData).forEach(equipment => {
                const stats = calculateEquipmentStats(equipment.dailyStatus);
                totalReady += parseFloat(stats.readyPercent);
                totalCatatan += parseFloat(stats.catatanPercent);
                totalBreakdown += parseFloat(stats.breakdownPercent);
                count++;
            });

            return {
                avgReady: (totalReady / count).toFixed(1),
                avgCatatan: (totalCatatan / count).toFixed(1),
                avgBreakdown: (totalBreakdown / count).toFixed(1)
            };
        }

        // Generate trend indicator
        function generateTrend() {
            const rand = Math.random();
            if (rand < 0.6) {
                return '<span class="trend-indicator trend-up">↑ Membaik</span>';
            } else {
                return '<span class="trend-indicator trend-down">↓ Menurun</span>';
            }
        }

        // Update report period display
        function updateReportPeriod() {
            const select = document.getElementById('monthSelect');
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                               'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            const selectedMonth = parseInt(select.value);
            document.getElementById('reportPeriod').textContent = `${monthNames[selectedMonth]} 2025`;
        }

        // Render performance table
        function renderPerformanceTable() {
            const tbody = document.getElementById('performanceBody');
            let html = '';
            let index = 1;

            const filteredData = currentFilter === 'all' 
                ? Object.entries(monthlyData)
                : Object.entries(monthlyData).filter(([_, data]) => data.category === currentFilter);

            // Group by category
            const groupedData = {};
            filteredData.forEach(([equipNumber, data]) => {
                if (!groupedData[data.category]) {
                    groupedData[data.category] = [];
                }
                groupedData[data.category].push([equipNumber, data]);
            });

            // Render grouped data
            Object.entries(groupedData).forEach(([category, equipments]) => {
                equipments.forEach(([equipNumber, data]) => {
                    const stats = calculateEquipmentStats(data.dailyStatus);
                    
                    html += `
                        <tr onclick="showCalendar('${equipNumber}')" style="cursor: pointer;">
                            <td class="font-semibold text-gray-600">${index}</td>
                            <td>
                                <span class="inline-block px-3 py-1 rounded-lg text-xs font-semibold bg-blue-100 text-blue-700">
                                    ${categoryNames[category]}
                                </span>
                            </td>
                            <td class="font-bold text-gray-800">${equipNumber}</td>
                            <td>
                                <span class="percentage-badge ready-badge">${stats.readyPercent}%</span>
                                <span class="text-xs text-gray-500">(${stats.ready} hari)</span>
                            </td>
                            <td>
                                <span class="percentage-badge catatan-badge">${stats.catatanPercent}%</span>
                                <span class="text-xs text-gray-500">(${stats.catatan} hari)</span>
                            </td>
                            <td>
                                <span class="percentage-badge breakdown-badge">${stats.breakdownPercent}%</span>
                                <span class="text-xs text-gray-500">(${stats.breakdown} hari)</span>
                            </td>
                            <td style="min-width: 200px;">
                                <div class="progress-bar">
                                    <div class="progress-segment ready-bar" style="width: ${stats.readyPercent}%">
                                        ${stats.readyPercent > 5 ? stats.readyPercent + '%' : ''}
                                    </div>
                                    <div class="progress-segment catatan-bar" style="width: ${stats.catatanPercent}%">
                                        ${stats.catatanPercent > 5 ? stats.catatanPercent + '%' : ''}
                                    </div>
                                    <div class="progress-segment breakdown-bar" style="width: ${stats.breakdownPercent}%">
                                        ${stats.breakdownPercent > 5 ? stats.breakdownPercent + '%' : ''}
                                    </div>
                                </div>
                            </td>
                            <td>${generateTrend()}</td>
                        </tr>
                    `;
                    index++;
                });
            });

            tbody.innerHTML = html;
        }

        // Render category summary
        function renderCategorySummary() {
            const container = document.getElementById('categorySummary');
            let html = '';

            Object.entries(categoryNames).forEach(([category, name]) => {
                const categoryEquipments = Object.entries(monthlyData)
                    .filter(([_, data]) => data.category === category);
                
                if (categoryEquipments.length === 0) return;

                let totalReady = 0, totalCatatan = 0, totalBreakdown = 0;
                
                categoryEquipments.forEach(([_, data]) => {
                    const stats = calculateEquipmentStats(data.dailyStatus);
                    totalReady += parseFloat(stats.readyPercent);
                    totalCatatan += parseFloat(stats.catatanPercent);
                    totalBreakdown += parseFloat(stats.breakdownPercent);
                });

                const count = categoryEquipments.length;
                const avgReady = (totalReady / count).toFixed(1);
                const avgCatatan = (totalCatatan / count).toFixed(1);
                const avgBreakdown = (totalBreakdown / count).toFixed(1);

                html += `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-bold text-gray-800 mb-3">${name} (${count} unit)</h4>
                        <div class="progress-bar mb-2">
                            <div class="progress-segment ready-bar" style="width: ${avgReady}%">
                                ${avgReady > 5 ? avgReady + '%' : ''}
                            </div>
                            <div class="progress-segment catatan-bar" style="width: ${avgCatatan}%">
                                ${avgCatatan > 5 ? avgCatatan + '%' : ''}
                            </div>
                            <div class="progress-segment breakdown-bar" style="width: ${avgBreakdown}%">
                                ${avgBreakdown > 5 ? avgBreakdown + '%' : ''}
                            </div>
                        </div>
                        <div class="flex justify-between text-xs md:text-sm mt-2">
                            <span class="percentage-badge ready-badge">Ready: ${avgReady}%</span>
                            <span class="percentage-badge catatan-badge">Catatan: ${avgCatatan}%</span>
                            <span class="percentage-badge breakdown-badge">Breakdown: ${avgBreakdown}%</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Show calendar modal
        function showCalendar(equipNumber) {
            const data = monthlyData[equipNumber];
            const modal = document.getElementById('calendarModal');
            const modalTitle = document.getElementById('modalTitle');
            const calendarContent = document.getElementById('calendarContent');

            modalTitle.textContent = `Detail Harian - ${equipNumber}`;

            const stats = calculateEquipmentStats(data.dailyStatus);
            
            let html = `
                <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                    <div class="grid grid-cols-3 gap-2 text-center text-sm">
                        <div>
                            <div class="font-bold text-green-600">${stats.readyPercent}%</div>
                            <div class="text-xs text-gray-600">Ready</div>
                        </div>
                        <div>
                            <div class="font-bold text-amber-600">${stats.catatanPercent}%</div>
                            <div class="text-xs text-gray-600">Catatan</div>
                        </div>
                        <div>
                            <div class="font-bold text-red-600">${stats.breakdownPercent}%</div>
                            <div class="text-xs text-gray-600">Breakdown</div>
                        </div>
                    </div>
                </div>
                <div class="calendar-grid">
            `;

            data.dailyStatus.forEach(day => {
                html += `
                    <div class="calendar-day ${day.status}" title="${day.day} - ${day.status}">
                        <div class="text-xs text-gray-600">Tgl</div>
                        <div class="font-bold">${day.day}</div>
                    </div>
                `;
            });

            html += `</div>`;

            calendarContent.innerHTML = html;
            modal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            const modal = document.getElementById('calendarModal');
            modal.classList.remove('active');
        }

        // Filter by category
        function filterByCategory() {
            const select = document.getElementById('categoryFilter');
            currentFilter = select.value;
            renderPerformanceTable();
        }

        // Update report
        function updateReport() {
            const select = document.getElementById('monthSelect');
            const month = parseInt(select.value);
            const daysInMonth = new Date(2025, month + 1, 0).getDate();
            
            document.getElementById('totalDays').textContent = daysInMonth;
            
            monthlyData = generateMonthlyData(daysInMonth);
            
            const overallStats = calculateOverallStats();
            document.getElementById('avgReady').textContent = overallStats.avgReady + '%';
            document.getElementById('avgCatatan').textContent = overallStats.avgCatatan + '%';
            document.getElementById('avgBreakdown').textContent = overallStats.avgBreakdown + '%';
            
            updateReportPeriod();
            renderPerformanceTable();
            renderCategorySummary();
        }

        // Go back
        function goBack() {
            alert('Kembali ke halaman Dashboard');
        }

        // Export report
        function exportReport() {
            alert('Fitur export Excel akan segera tersedia!');
        }

        // Print report
        function printReport() {
            window.print();
        }

        // Close modal on outside click
        document.getElementById('calendarModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize
        updateReport();
    </script>
</body>
</html>